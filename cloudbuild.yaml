# Langkah 1: Membangun image Docker
- name: "gcr.io/cloud-builders/docker"
  args: ["build", "-t", "gcr.io/ide-kita/backend-idekita:1.0", "."]

# Langkah 2: Menyimpan secret sebagai variabel lingkungan
- name: "gcr.io/cloud-builders/gcloud"
  entrypoint: "bash"
  args:
    - "-c"
    - |
      echo "$$SERVICE_ACCOUNT_KEY" > /workspace/service-account-key.json

# Langkah 3: Mengunggah image Docker ke Container Registry
- name: "gcr.io/cloud-builders/docker"
  args: ["push", "gcr.io/ide-kita/backend-idekita:1.0"]

# Langkah 4: Menerbitkan aplikasi ke Cloud Run
- name: "gcr.io/cloud-builders/gcloud"
  args:
    - "run"
    - "deploy"
    - "backend"
    - "--image"
    - "gcr.io/ide-kita/backend-idekita:1.0"
    - "--platform"
    - "managed"
    - "--region"
    - "asia-southeast2"
    - "--allow-unauthenticated"
